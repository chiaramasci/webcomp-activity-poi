<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="css/all.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="static/css/components/categories.css" />
		<link rel="stylesheet" type="text/css" href="static/css/theme.css" />
		<link rel="stylesheet" type="text/css" href="static/css/atoms.css" />
	</head>
	<body>
		<div class="categoriesContainer">
				<div class="dropdownCategory">
					<div class="category">
						<img 
							class="categoryImage" 
							src="/img/category_icons/Kultur Sehenswuerdigkeiten.svg" 
							alt="img_alt"
						>
					</div>
					<div class="subCategory">
						<p style="color: #FB8464;">Culture and Attractions</p>
						<div class="subCategoryItem">
							<input type="checkbox" id="museums" name="museums" value="museums">
							<label for="museums">Museums</label>
						</div>
					</div>
				</div>
		</div>
		<script>
			// https://tourism.opendatahub.bz.it/api/ODHActivityPoiTypes
			async function main()
			{
				// parameters
				let index_match = window.location.search.match(new RegExp("[?&]index=([^&]+)"));
				let lang_match  = window.location.search.match(new RegExp("[?&]lang=([^&]+)"));
	
				let index = index_match != null ? index_match[1]: 0;
				let lang  = lang_match  != null ? lang_match[1]: 'it';
	
				let category_template = document.querySelector('div.dropdownCategory')
				let category_parent = category_template.parentElement
				category_template.remove()
				
				// read data json
				
				let response = await fetch('poi-types.json')
				let types = await response.json()
				
				for (let i = 0; i < types.length; i++)
				{
					let type = types[i]
					if (type.Type != 'Type')
						continue;
					
					// console.log(type.Key)
					// console.log(type.TypeDesc[lang])
					
					let category = category_template.cloneNode(true)
					category.querySelector('div.subCategory > p').textContent = type.TypeDesc[lang]
					category.querySelector('div.subCategory > p').textContent = type.TypeDesc[lang]
					category.querySelector('img.categoryImage').alt = type.TypeDesc[lang]
					let imageFileName = type.TypeDesc["de"].replace(/\u00e4/g, "ae")
					imageFileName = imageFileName.replace(/\u00f6/g, "oe")
					imageFileName = imageFileName.replace(/\u00fc/g, "ue")
					imageFileName = imageFileName.replace(/\u00c4/g, "Ae")
					imageFileName = imageFileName.replace(/\u00d6/g, "Oe")
					imageFileName = imageFileName.replace(/\u00dc/g, "Ue")
					imageFileName = imageFileName.trim()
					category.querySelector('img.categoryImage').src = "/img/category_icons/" + imageFileName + ".svg"
					category_parent.appendChild(category)

					let sub_category_template = category.querySelector('div.subCategoryItem')
					let sub_category_parent = sub_category_template.parentElement
					sub_category_template.remove()

					for (let j = 0; j < types.length; j++)
					{
						let subtype = types[j]
						if (subtype.Type != 'SubType' || subtype.Parent != type.Key)
							continue;
						// console.log(subtype)
						let sub_category = sub_category_template.cloneNode(true)
						sub_category.querySelector('label').textContent = subtype.TypeDesc[lang]
						sub_category_parent.appendChild(sub_category)
					}
				}
				
				let subCat = document.querySelectorAll('div.subCategory');
				for (let j = 0; j < subCat.length/2; j++)
				{
					subCat[j].classList.add('subCategoryLeft');
					console.log(subCat[j].classList)
				}
				for (let j = subCat.length/2; j < subCat.length; j++)
				{
					subCat[j].classList.add('subCategoryRight');
				}
				
			}
			main()
		</script>
	</body>
</html>
